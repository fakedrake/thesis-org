\begin{frame}
  \frametitle{FluiDB at a glance}

  \begin{itemize}
  \item FluiDB is an in-memory RDBMS
  \item Radical approach to IR recycling: adapt data layout to the
    workload
    \begin{itemize}
    \item enable efficient plans
    \item constrained (quality) budget
    \end{itemize}

  \item The main novelty relates to the introduction of reversible
    relational operations which affords a new perspective on query
    planning and view selection.
  \item FluiDB materializes all intermediate results and deletes garbage
    collects when she runs out of space.
  \end{itemize}
\end{frame}


\newcommand{\n}[1]{node {\(#1\)}}
\newcommand{\bn}[1]{node[mat] {\(#1\)}}

\newcommand\fundamentalprinciple[7]{
  \begin{tikzdiagram_w}
    \tikzset{
      grow=up,
      sibling distance=3cm,
      level distance=3cm,
      every node/.style={draw},
      mat/.style={fill=gray!30},
      nomat/.style={}
    };

    \node[#7] {\(\li\)} % \li
    child { node[#6] {\(\sigma_{q} \li \)}} % σ_q
    child { node[#5] {\(\sigma_{\neg q} \li\)}} % σ_nq
    child { node[#4] { \(\sigma_{\neg p} \li \)}}  % σ_np
    child {
      node[#3]{\(\sigma_{p} \li\)} % σ_p
      child {node[#2]{\(\sigma_{p \land r} \li\)} } % σ_pq
      child {node[#1]{\(\sigma_{p \land \neg r} \li\)}} % σ_rpq
    } ;
  \end{tikzdiagram_w}
}

\begin{frame}
  \frametitle{Example 1: \(\sigma_{p \land r} \li\)}
  \only<1>{\fundamentalprinciple{nomat}{nomat}{nomat}{nomat}{mat}{mat}{nomat}}
  \only<2>{\fundamentalprinciple{nomat}{nomat}{nomat}{nomat}{mat}{mat}{mat}}
  \only<3>{\fundamentalprinciple{nomat}{nomat}{nomat}{nomat}{nomat}{nomat}{mat}}
  \only<4>{\fundamentalprinciple{nomat}{nomat}{mat}{mat}{nomat}{nomat}{mat}}
  \only<5>{\fundamentalprinciple{nomat}{nomat}{mat}{mat}{nomat}{nomat}{nomat}}
  \only<6>{\fundamentalprinciple{nomat}{mat}{mat}{mat}{nomat}{nomat}{nomat}}
\end{frame}

\begin{frame}[fragile]{Template query}
\begin{minted}[escapeinside=||,mathescape=true]{sql}
  select      n_name, avg(l_discount)
  from        lineitem, customer, nation, order
  where       l_orderkey = o_orderkey
  and         c_custkey = o_custkey
  and         c_nationkey = n_nationkey
  and         l_shipdate > |\(\mathit{\$\{min\_date\}}\)|
  group by    n_name
\end{minted}
\end{frame}


\begin{frame}{Example 2: Traditionally greedy plan}
  \begin{tikzdiagram_h}
    \tikzset{
      every node/.style={draw,rectangle, align=center},
      sibling distance=5cm,
      level distance=1.5cm
    };
    \node{\gamma}
    child {node{\(\Join\)}
      child {node{\(\Join\)}
        child {node{\(\Join\)}
          child {
            node{\(\sigma_{\mathit{l\_shipdate} > \mathit{\$\{min\_date\}}}\)}
            child { node{lineitem}}
          }
          child {node {nation}}
        }
        child {node{customer}}
      }
      child {node{order}}
    };

  \end{tikzdiagram_h}
\end{frame}

\begin{frame}{Example 2: Adapt to workload}
  \begin{tikzdiagram_h}
    \tikzset{
      every node/.style={draw,rectangle, align=center},
      sibling distance=5cm,
      level distance=1.5cm
    };
    \node{\gamma}
    child {
      node{\(\sigma_{shipdate > \$\{min\_date\}}\)}
      child {node (mat){\(\Join\)}
        child {node{\(\Join\)}
          child {node{\(\Join\)}
            child { node (li) {lineitem}}
            child { node (nation) {nation}}
          }
          child {node (cust) {customer}}
        }
        child {node (order) {order}}
      }
    };
    \only<2->{\node[draw=none] (n) [left = of mat] {Keep materialized} edge [-stealth] (mat);}
    \uncover<3>{\path node[draw=none] (n) [below = of order] {Redundant data}
      edge [-stealth] (li)
      edge [-stealth] (order)
      edge [-stealth] (cust)
      edge [-stealth] (nation);}


  \end{tikzdiagram_h}

\end{frame}



\begin{frame}
  \frametitle{The interesting components}

  \begin{itemize}
  \item Graph management and query normal form representation
  \item Logical planning infrastructure
  \item Antisthenis: An incremental numeric evaluation system for cost
    estimation.
  \item Logical planning algorithm and garbage collector
  \item Code generation system.
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Architecture}


  % XXX: At the beginning of each case circle the relevant part of it
  % as an introduction.
  \begin{tikzdiagram_h}
    \tikzset{db/.style={cylinder,draw,shape border rotate=90,aspect=.3}};
    \tikzset{sys/.style={rectangle,draw}};
    \tikzset{outer/.style={cloud,draw,aspect=3}};

    \node[outer] (query) {Query stream};
    \node[sys] (graph_builder) [below = of query] {Graph Builder};

    \node[sys] (qnf) [left = of graph_builder] {QNF processor};

    \node[db] (bqg) [right = of graph_builder] {RA Graph};
    \node[sys] (planner) [below = of graph_builder] {Planner};

    \node[sys] (antisthenis) [left = of planner] {Antisthenis};
    \node[sys] (codegen) [below = of planner] {C++ generation};
    \node[sys] (cc) [below = of codegen] {C++ Compiler};
    \node[outer] (hw) [below = of cc] {CPU/Filesystem};

    \draw[->] (query) -> (graph_builder) -> (planner) -> (codegen) -> (cc) -> (hw);
    \draw[<->] (planner) -> (antisthenis);
    \draw[<->] (graph_builder) -> (qnf);
    \draw[<->] (graph_builder) -> (bqg);
  \end{tikzdiagram_h}
\end{frame}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "presentation"
%%% End:
