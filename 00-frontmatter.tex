%% Start the page numbering in roman
\setcounter{page}{1}%

%% Make the title page
\maketitle%

\begin{precontent}
\dictum[Bertolt Brecht -- Life of Galileo]{ If the scientists, brought
 to heel by self-interested rulers, limit themselves to piling up
 knowledge for knowledgeâ€™s sake, then science can be crippled and your
 new machines will lead to nothing but new impositions. You may in due
 course discover all that there is to discover, and your progress will
 nonetheless be nothing but a progress away from mankind. The gap
 between you and it may one day become so wide that your cry of
 triumph at some new achievement will be echoed by a universal cry of
 horror.}
%

\chapter{Abstract}%

It is a popular practice to use materialized intermediate results to improve the performance of RDBMSes. Work in this area has focused either optimizers matching existing materialized results in the cache and selecting intermediate results from a plan to survive the plan execution. To our knowledge, few attempts have been made to create plans with cached intermediate results in mind, and none that make any attempt to deduplicate the stored data to alleviate the storage cost of maintaining possibly large queries.

We built \emph{FluiDB} to explore a novel approach to integrating the selection of materialized results with the planner to optimize the logical representation of data in memory. FluiDB materializes common intermediate results and deduplucates data to alleviate the cost of maintaining them. This is achieved by introducing \emph{reversible operations}: versions of normal relational operators that may produce complementary tables alongside the normal output, that allow the reconstruction of the input relations. A planner aware of such operations can build query plans that dynamically adapt the data layout to the plan under a constrained memory budget. This thesis revolves around four main chapters, each of which describes in detail a different part of FluiDB and a final one that goes into evaluation of the system.

The first chapter focuses on query processing and the relational algebra semantics that FluiDB operates under. FluiDB parses queries into DAGs of sub-queries connected by reversible operators. Each such graph of the workload is merged into a global query graph that is used to infer properties of each relation like cardinality and extent.

The next chapter is dedicated to the planner and a novel monad for weighted backtracking that the planer is based on. The planner attempts to generate a plan by traversing the query graph so that, besides solving the query at hand, it leaves in memory a curated set of queries aiming to maximize the amortized performance of the workload being run. In this chapter, the garbage collector is also discussed, which is the part of the planner responsible for inserting plan fragments that delete nodes when required  such that the available storage budget is respected while no information is lost from the database.

After that, we go into \emph{Antisthenis}, a framework we built for defining incremental computation systems. Antisthenis is used to build modules of the planner that efficiently determine whether a relation materializable, and estimate the cost of materializing a relation, given a set of materialized relations. Besides computation reuse, Antisthenis is able to prune the computation taking advantage of properties of the operators involved like absorbing group elements  and bounded partial results. These techniques are also used to allow evaluation of some classes of self-referential computations.

The final chapter about the FluiDB architecture describes the transpilation of plans generated by the planner to C++, as well as the supporting libraries that enable the transpilation of queries to highly specialized C++ code, and the low level data organization of the database.

The thesis closes with a chapter that describes our methods for benchmarking and some experimental results.

\chapter{Lay Summary}%

A database is a computer program that can answer questions(\emph{queries}) based on a data stored in a medium accessible by the computer running the database, as well as provide an interface to manipulate said data. A \emph{relational database} is a database that organizes the underlying data into tables or \emph{relations}. Database systems rephrase the queries they receive in such a way that they can be answered efficiently, breaking them down to sub-queries, each subquery defined by an operator and one or more input operands, the sequence of subqueries generated being called a \emph{query plan}.

A well-studied method of increasing efficiency is to store the answers to commonly encountered subqueries (\emph{materialized views}) so they are readily available. This work describes the development of FluiDB, an experimental relational database system that explores the idea that the design decisions pertaining to planning and to maintaining a set of materialized views are interdependent and therefore should be addressed simultaneously from the start.

The design of FluiDB aspires to take one more step in that direction. Instead of asking which materialized views should be allowed to survive the execution of a query plan, we frame the problem as one of adapting the layout of the data to maximize efficiency of answering the the sequence of queries as a whole.

\chapter{Acknowledgements}%

This thesis is dedicated to all the people that directly or indirectly
supported me though my PhD studies, but also to all the people
without whose support and hard work I would never have started this
work to begin with.

It is customary to thank the supervisors first regardless of the
circumstances but I would like to underline my gratitude to Stratis
who really understood my idiosyncratic way of working and provided
precisely the quality and quantity of guidance that I required. This
is a rare quality and I cherish the opportunity I had to work with
him. I would also like to express my gratitude to Boris Grot, not just
in the general sense but because, especially during the first years of
my thesis he went out of his way to make me feel included and gave
value to my voice. For the similar reasons I would like to thank
Christophe Dubach whose door was always open and his whiteboard always
available, I deeply appreciate all the times he was willng to
patiently listen to my crazy ideas.

I would like to thank my family and especially my parents, for being
with me every step of the bumpy road that was my PhD, but mostly
because without their hard work and sacrifises a PhD would not have
been an option for me. I am priviledged and humbled and I owe it
primarily to them.

I would also like to thank Marina without whom I would definitely have
given up in one of the many moments of desparation. Thank you for
helping me with the impossible task of finishing a PhD during a
pandemic.

Special thank you to my flatmate for two years Christos Velanis who
got me safe and sound through some fairly dark times, and for the
ideological steeling brought about by this cohabitation. Thanks to him
and to Christos Maniatis for the heated philosophical debates that
would typically end after 6am.

Last but not least I would like to thank my friends that were there
though all of it, the thick and the thin Antreas, Giannis, Aisha,
Maria, Irini, Iordanis, Nelly, Christos, Pigi, Niki, The President,
and Nikolas.

%%%% DECLARATION

%% Use a custom declaration

% \declaration{I did it.}

%% Use the standard regulation declaration. Enter your
%% name for the signature line.

\standarddeclaration{Christos Perivolaropoulos}

\end{precontent}


\tableofcontents

%% List of figures
\cleardoublepage
\phantomsection
\addcontentsline{toc}{chapter}{\listfigurename}
\listoffigures
\listoflistings

\cleardoublepage%
